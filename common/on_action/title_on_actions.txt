#On actions about titles

# All on-actions in this file provide scope:transfer_type unless otherwise noted
# scope:transfer_type has the following permutations:
# flag:conquest
# flag:conquest_holy_war
# flag:conquest_claim
# flag:conquest_populist
# flag:inheritance
# flag:abdication
# flag:destroyed
# flag:created
# flag:usurped
# flag:granted
# flag:revoked
# flag:election
# flag:independency
# flag:returned
# flag:leased_out
# flag:lease_revoked
# flag:faction_demand
# flag:swear_fealty

# A title is destroyed
# root = the holder before destruction
# scope:landed_title = the title that is being destroyed
# Does *not* provide scope:transfer_type
on_title_destroyed = {
	events = {
	}
}

# A title is transferred to a new character
# root = the new holder
# scope:title = the title that changes hands
# scope:previous_holder = previous holder. Might be dead
on_title_gain = {
	effect = {
		if = {
			limit = {
				scope:title = { is_holy_order = yes }
				NOT = { has_trait = order_member }
				has_government = holy_order_government
			}
			add_trait = order_member
		}

		#Did I receive a title from my sibling?
		if = {
			limit = {
				exists = scope:previous_holder
				scope:previous_holder = {
					is_alive = yes
					exists = var:sibling_waiting_for_land
					any_sibling = {
						this = root
						this = scope:previous_holder.var:sibling_waiting_for_land
					}
				}
			}
			add_character_flag = {
				flag = got_title_from_sibling
				years = 4
			}
		}

		### AVE MARIA ROMAN ADMINISTRATION EFFECTS	
		## Terms of office event
		# if = {
		# 	limit = {
		# 		root = {
		# 			uses_roman_govt = yes
		# 		}
		# 	}
		# 	root = {
		# 		trigger_event = { id = ave_maria_roman_administration_events.00012 }
		# 	}
		# }
		## Assigning realm law
		if = {
			limit = {
				root = {
					uses_roman_govt = yes
					NOT = { has_realm_law = ave_maria_roman_administration_imperial }
				}				
			}
			root = {
				add_realm_law_skip_effects = ave_maria_roman_administration_imperial
			}
		}
		## Assigning Tagma government type when gaining a Tagma title
		if = {
			limit = {
				root = {
					top_liege = {
						any_held_title = {
							OR = {
								this = title:e_byzantium
								this = title:e_roman_empire
							}
						}
					}
				}
				scope:title = { roman_administration_is_a_tagma_title_trigger = yes }
			}
			root = {
				change_government = roman_administration_military_government
				#add_realm_law = ave_maria_roman_administration_imperial
			}
		}
		## Assigning Doukaton government type when gaining a Doukaton title
		if = {
			limit = {
				root = {
					top_liege = {
						any_held_title = {
							OR = {
								this = title:e_byzantium
								this = title:e_roman_empire
							}
						}
					}
				}
				#scope:title = { roman_administration_is_a_doukaton_title_trigger = yes }
				#root = { roman_administration_holds_doukaton_title_trigger = yes }
				scope:previous_holder = {
					vassal_contract_has_flag = is_doukaton
				}
			}
			root = {
				change_government = roman_administration_doukaton_government
				#add_realm_law = ave_maria_roman_administration_imperial
			}
		}
		## Giving Theme Government type to someone gaining a title under the emperor
		if = {
			limit = {
				root = {
					top_liege = {
						any_held_title = {
							OR = {
								this = title:e_byzantium
								this = title:e_roman_empire
							}
						}
					}
					primary_title = { 
						NOR = { this = title:e_byzantium this = title:e_roman_empire }
						#roman_administration_is_a_military_title_trigger = no
					}
				}
				# scope:title = { 
				# 	roman_administration_is_a_military_title_trigger = no
				# 	#tier <= tier_duchy
				# }
				scope:previous_holder = {
					vassal_contract_has_flag = is_theme
				}
			}
			root = {
				change_government = roman_administration_theme_government
				#add_realm_law = ave_maria_roman_administration_imperial
			}
		}
		## Giving Kouratoreia Government to someone gaining a title under the emperor
		if = {
			limit = {
				root = {
					top_liege = {
						any_held_title = {
							OR = {
								this = title:e_byzantium
								this = title:e_roman_empire
							}
						}
					}
					primary_title = { 
						NOR = { this = title:e_byzantium this = title:e_roman_empire }
						roman_administration_is_a_military_title_trigger = no
					}
				}
				scope:title = { 
					roman_administration_is_a_military_title_trigger = no
					#tier <= tier_duchy
				}
				scope:previous_holder = {
					vassal_contract_has_flag = is_kouratoreia
				}
			}
			root = {
				change_government = roman_administration_kouratoreia_government
			}
		}
		## If you inherit the Roman Empire, clear all your previous titles except familial estates
		if = {
			limit = {
				primary_title = {
					this = title:e_byzantium
				}
				scope:title = { this = title:e_byzantium }
			}
			root = {
				roman_administration_emperor_inheritance_effect = yes
				roman_administration_civilian_titles_transfer = yes

				## Counting up number of dynastic emperors
				dynasty = {
					if = {
						limit = {
							NOT = { 
								has_variable = roman_administration_dynastic_number_of_emperors
							}
						}
						set_variable = {
							name = roman_administration_dynastic_number_of_emperors
							value = 0
						}
						change_variable = {
							name = roman_administration_dynastic_number_of_emperors
							add = 1
						}
					}
					if = {
						limit = {
							has_variable = roman_administration_dynastic_number_of_emperors
						}
						change_variable = {
							name = roman_administration_dynastic_number_of_emperors
							add = 1
						}
					}
				}

				## Updating Legitimacy
				every_courtier = {
					roman_administration_update_legitimacy_variable = yes
				}
				every_vassal = {
					roman_administration_update_legitimacy_variable = yes
					every_courtier = {
						roman_administration_update_legitimacy_variable = yes
					}
				}
			}
			# scope:previous_holder = {
			# 	if = {
			# 		limit = {
			# 			is_alive = yes
			# 		}
			# 		scope:previous_holder = {
			# 			roman_administration_remove_terms_of_office_modifier_and_variable = yes
			# 			roman_administration_remove_salary_indicator = yes
			# 		}
					
			# 	}
			# }			
			resolve_title_and_vassal_change = scope:change
		}
		## When inheriting an office duchy title you always get the capital and the de_jure titles
		if = {
			limit = {
				root = {
					top_liege = {
						any_held_title = {
							OR = {
								this = title:e_byzantium
								this = title:e_roman_empire
							}
						}
					}
				}
				scope:title = { 
					tier = tier_duchy
				}
			}
			scope:title = {
				if = {
					limit = {
						scope:title = {
							roman_administration_is_a_tagma_title_trigger = no
							tier >= tier_duchy
						}
					}
					## Capital transfer
					scope:title.title_capital_county = {
						create_title_and_vassal_change = {
							type = granted
							save_scope_as = change
							add_claim_on_loss = yes
						}
						root = {
							save_scope_as = title_heir
						}
						change_title_holder = {
							holder = scope:title_heir
							change = scope:change
						}
					}
					resolve_title_and_vassal_change = scope:change
					
					## The rest
					every_in_de_jure_hierarchy = {
						limit = {
							#tier = tier_county
							tier > tier_barony
							NOT = { 
								this = { has_title_law = ave_maria_roman_administration_family_succession_law }
								has_title_law = ave_maria_roman_administration_family_succession_law							
							}
							NOT = { 
								holder = {
									any_held_title = { this = title:e_byzantium }
								}
							}
							holder = {
								top_liege = {
									any_held_title = { this = title:e_byzantium }
								}
							}
						}
						if = {
							limit = {
								exists = holder
							}
							create_title_and_vassal_change = {
								type = granted
								save_scope_as = change
								add_claim_on_loss = yes
							}
							save_temporary_scope_as = title_to_inherit
							root = {
								save_scope_as = title_heir
							}
							change_title_holder = {
								holder = scope:title_heir
								change = scope:change
							}
							resolve_title_and_vassal_change = scope:change
						}
					}
					resolve_title_and_vassal_change = scope:change
				}

				### Military transfer deprecated since removal of provincial duality krites/strategos
				# if = {
				# 	limit = {
				# 		scope:title = {
				# 			roman_administration_is_a_military_title_trigger = yes
				# 			title_capital_county = {
				# 				holder = {
				# 					top_liege = {
				# 						primary_title = { this = title:e_byzantium }
				# 					}
				# 				}
				# 			}
				# 		}
				# 	}
				# 	## Military Duchy Capital transfer
				# 	scope:title.title_capital_county = {
				# 		create_title_and_vassal_change = {
				# 			type = granted
				# 			save_scope_as = change
				# 			add_claim_on_loss = yes
				# 		}
				# 		root = {
				# 			save_scope_as = title_heir
				# 		}
				# 		change_title_holder = {
				# 			holder = scope:title_heir
				# 			change = scope:change
				# 		}
				# 	}
				# 	resolve_title_and_vassal_change = scope:change
					
				# 	## Military Duchy de jure titles transfer
				# 	every_in_de_jure_hierarchy = {
				# 		limit = {
				# 			#tier = tier_county
				# 			tier > tier_barony
				# 			NOT = { 
				# 				this = { has_title_law = ave_maria_roman_administration_family_succession_law }		
				# 			}
				# 			NOT = { 
				# 				holder = {
				# 					primary_title = { this = title:e_byzantium }
				# 				}
				# 			}
				# 		}
				# 		if = {
				# 			limit = {
				# 				exists = holder
				# 			}
				# 			create_title_and_vassal_change = {
				# 				type = granted
				# 				save_scope_as = change
				# 				add_claim_on_loss = yes
				# 			}
				# 			save_temporary_scope_as = title_to_inherit
				# 			root = {
				# 				save_scope_as = title_heir
				# 			}
				# 			change_title_holder = {
				# 				holder = scope:title_heir
				# 				change = scope:change
				# 			}
				# 			resolve_title_and_vassal_change = scope:change
				# 		}
				# 	}
				# 	resolve_title_and_vassal_change = scope:change
				# }
			}

			resolve_title_and_vassal_change = scope:change
		}

		### AVE MARIA CHRISTIAN FLAVOUR EFFECTS
		## Giving the pope the pope trait
		if = {
			limit = {
				scope:title = {
					this = title:k_papal_state
				}
			}
			root = {
				add_trait = pope
			}
			scope:previous_holder = {
				remove_trait = pope
			}
		}
		## Giving bishops a special trait to prevent them from marrying
		if = {
			limit = {
				scope:title = {
					NOT = { this = title:k_papal_state }
				}
				has_government = theocracy_government
				religion = religion:christianity_religion
				highest_held_title_tier = tier_duchy
			}
			add_trait = bishop
		}

		## ORC Malus Distance Application
		# root = {
		# 	if = {
		# 		limit = {
		# 			is_landed = yes
		# 			highest_held_title_tier >= tier_county
		# 		}
		# 		orc_apply_demesne_provinces_distance_malus = yes
		# 		#trigger_event = ave_maria_opus_ruralium_commodorum.0001
		# 	}
		# 	# orc_apply_demesne_provinces_distance_malus = yes
		# 	# orc_apply_demesne_provinces_distance_malus_modifier = yes
		# 	#trigger_event = ave_maria_opus_ruralium_commodorum.0001
		# }

	}
	events = {
		roman_restoration.0005 #New Roman Emperor gets Augustus trait. (old holder, if still alive, loses it)
		roman_restoration.0199 #Restoring the Pentarchy.
		religious_decision.0312 #New holder of a county with a runestone
		coa.1 # check if title Coat of Arms should change.

		## Roman Administration Terms of Office variable assignement
		ave_maria_roman_administration_events.00012

	}
}

# A title is inherited by a character
# root = the new holder
# scope:title = the title that changes hands
# scope:previous_holder = previous holder. Should be dead
on_title_gain_inheritance = {
	events = {
		## Roman Administration Terms of Office variable assignement
		ave_maria_roman_administration_events.00012

	}
	effect = {
		if = {
			limit = {
				scope:title = title:e_mongol_empire
				has_character_flag = gain_mongol_succession_dread
			}
			add_dread = 50
		}

		### AVE MARIA ROMAN ADMINISTRATION EFFECTS	
		
		## Assigning Tagma government type when gaining a Tagma title
		if = {
			limit = {
				root = {
					top_liege = {
						any_held_title = {
							OR = {
								this = title:e_byzantium
								this = title:e_roman_empire
							}
						}
					}
				}
				scope:title = { roman_administration_is_a_tagma_title_trigger = yes }
			}
			root = {
				change_government = roman_administration_military_government
				add_realm_law = ave_maria_roman_administration_imperial
			}
		}
		## Assigning Doukaton government type when gaining a Doukaton title
		if = {
			limit = {
				root = {
					top_liege = {
						any_held_title = {
							OR = {
								this = title:e_byzantium
								this = title:e_roman_empire
							}
						}
					}
				}
				#scope:title = { roman_administration_is_a_doukaton_title_trigger = yes }
				#root = { roman_administration_holds_doukaton_title_trigger = yes }
				scope:previous_holder = {
					vassal_contract_has_flag = is_doukaton
				}
			}
			root = {
				change_government = roman_administration_doukaton_government
				add_realm_law = ave_maria_roman_administration_imperial
			}
		}
		## Giving Theme Government type to someone gaining a title under the emperor
		if = {
			limit = {
				root = {
					top_liege = {
						any_held_title = {
							OR = {
								this = title:e_byzantium
								this = title:e_roman_empire
							}
						}
					}
					primary_title = { 
						NOR = { this = title:e_byzantium this = title:e_roman_empire }
						#roman_administration_is_a_military_title_trigger = no
					}
				}
				# scope:title = { 
				# 	roman_administration_is_a_military_title_trigger = no
				# 	#tier <= tier_duchy
				# }
				scope:previous_holder = {
					vassal_contract_has_flag = is_theme
				}
			}
			root = {
				change_government = roman_administration_theme_government
				add_realm_law = ave_maria_roman_administration_imperial
			}
		}
		## Giving Kouratoreia Government to someone gaining a title under the emperor
		if = {
			limit = {
				root = {
					top_liege = {
						any_held_title = {
							OR = {
								this = title:e_byzantium
								this = title:e_roman_empire
							}
						}
					}
					primary_title = { 
						NOR = { this = title:e_byzantium this = title:e_roman_empire }
						roman_administration_is_a_military_title_trigger = no
					}
				}
				scope:title = { 
					roman_administration_is_a_military_title_trigger = no
					#tier <= tier_duchy
				}
				scope:previous_holder = {
					vassal_contract_has_flag = is_kouratoreia
				}
			}
			root = {
				change_government = roman_administration_kouratoreia_government
			}
		}
		## If you inherit the Roman Empire, clear all your previous titles except familial estates
		if = {
			limit = {
				primary_title = {
					this = title:e_byzantium
				}
				scope:title = { this = title:e_byzantium }
			}
			root = {
				roman_administration_emperor_inheritance_effect = yes
				roman_administration_civilian_titles_transfer = yes

				## Counting up number of dynastic emperors
				dynasty = {
					if = {
						limit = {
							NOT = { 
								has_variable = roman_administration_dynastic_number_of_emperors
							}
						}
						set_variable = {
							name = roman_administration_dynastic_number_of_emperors
							value = 0
						}
						change_variable = {
							name = roman_administration_dynastic_number_of_emperors
							add = 1
						}
					}
					if = {
						limit = {
							has_variable = roman_administration_dynastic_number_of_emperors
						}
						change_variable = {
							name = roman_administration_dynastic_number_of_emperors
							add = 1
						}
					}
				}

				## Updating Legitimacy
				every_courtier = {
					roman_administration_update_legitimacy_variable = yes
				}
				every_vassal = {
					roman_administration_update_legitimacy_variable = yes
					every_courtier = {
						roman_administration_update_legitimacy_variable = yes
					}
				}
			}			
			resolve_title_and_vassal_change = scope:change
			# scope:previous_holder = {
			# 	if = {
			# 		limit = {
			# 			is_alive = yes
			# 		}
			# 		scope:previous_holder = {
			# 			roman_administration_remove_terms_of_office_modifier_and_variable = yes
			# 			roman_administration_remove_salary_indicator = yes
			# 		}					
			# 	}
			# }
		}
		## When inheriting an office duchy title you always get the capital and the de_jure titles
		if = {
			limit = {
				root = {
					top_liege = {
						any_held_title = {
							OR = {
								this = title:e_byzantium
								this = title:e_roman_empire
							}
						}
					}
				}
				scope:title = { 
					tier = tier_duchy
				}
			}
			scope:title = {
				if = {
					limit = {
						scope:title = {
							roman_administration_is_a_tagma_title_trigger = no
							tier >= tier_duchy
						}
					}
					## Capital transfer
					scope:title.title_capital_county = {
						create_title_and_vassal_change = {
							type = granted
							save_scope_as = change
							add_claim_on_loss = yes
						}
						root = {
							save_scope_as = title_heir
						}
						change_title_holder = {
							holder = scope:title_heir
							change = scope:change
						}
					}
					resolve_title_and_vassal_change = scope:change
					
					## The rest
					every_in_de_jure_hierarchy = {
						limit = {
							#tier = tier_county
							tier > tier_barony
							NOT = { 
								this = { has_title_law = ave_maria_roman_administration_family_succession_law }
								has_title_law = ave_maria_roman_administration_family_succession_law							
							}
							NOT = { 
								holder = {
									any_held_title = { this = title:e_byzantium }
								}
							}
							holder = {
								top_liege = {
									any_held_title = { this = title:e_byzantium }
								}
							}
						}
						if = {
							limit = {
								exists = holder
							}
							create_title_and_vassal_change = {
								type = granted
								save_scope_as = change
								add_claim_on_loss = yes
							}
							save_temporary_scope_as = title_to_inherit
							root = {
								save_scope_as = title_heir
							}
							change_title_holder = {
								holder = scope:title_heir
								change = scope:change
							}
							resolve_title_and_vassal_change = scope:change
						}
					}
					resolve_title_and_vassal_change = scope:change
				}

				### Military transfer deprecated since removal of provincial duality krites/strategos
				# if = {
				# 	limit = {
				# 		scope:title = {
				# 			roman_administration_is_a_military_title_trigger = yes
				# 			title_capital_county = {
				# 				holder = {
				# 					top_liege = {
				# 						primary_title = { this = title:e_byzantium }
				# 					}
				# 				}
				# 			}
				# 		}
				# 	}
				# 	## Military Duchy Capital transfer
				# 	scope:title.title_capital_county = {
				# 		create_title_and_vassal_change = {
				# 			type = granted
				# 			save_scope_as = change
				# 			add_claim_on_loss = yes
				# 		}
				# 		root = {
				# 			save_scope_as = title_heir
				# 		}
				# 		change_title_holder = {
				# 			holder = scope:title_heir
				# 			change = scope:change
				# 		}
				# 	}
				# 	resolve_title_and_vassal_change = scope:change
					
				# 	## Military Duchy de jure titles transfer
				# 	every_in_de_jure_hierarchy = {
				# 		limit = {
				# 			#tier = tier_county
				# 			tier > tier_barony
				# 			NOT = { 
				# 				this = { has_title_law = ave_maria_roman_administration_family_succession_law }		
				# 			}
				# 			NOT = { 
				# 				holder = {
				# 					primary_title = { this = title:e_byzantium }
				# 				}
				# 			}
				# 		}
				# 		if = {
				# 			limit = {
				# 				exists = holder
				# 			}
				# 			create_title_and_vassal_change = {
				# 				type = granted
				# 				save_scope_as = change
				# 				add_claim_on_loss = yes
				# 			}
				# 			save_temporary_scope_as = title_to_inherit
				# 			root = {
				# 				save_scope_as = title_heir
				# 			}
				# 			change_title_holder = {
				# 				holder = scope:title_heir
				# 				change = scope:change
				# 			}
				# 			resolve_title_and_vassal_change = scope:change
				# 		}
				# 	}
				# 	resolve_title_and_vassal_change = scope:change
				# }
			}

			resolve_title_and_vassal_change = scope:change
		}

		### AVE MARIA CHRISTIAN FLAVOUR EFFECTS
		## Giving the pope the pope trait
		if = {
			limit = {
				scope:title = {
					this = title:k_papal_state
				}
			}
			root = {
				add_trait = pope
			}
			scope:previous_holder = {
				remove_trait = pope
			}
		}
		## Giving bishops a special trait to prevent them from marrying
		if = {
			limit = {
				scope:title = {
					NOT = { this = title:k_papal_state }
				}
				has_government = theocracy_government
				religion = religion:christianity_religion
				highest_held_title_tier = tier_duchy
			}
			add_trait = bishop
		}
	}
}

# A title is usurped by a character
# root = the new holder
# scope:title = the title that changes hands
# scope:previous_holder = previous holder. Shouldn't be dead
on_title_gain_usurpation = {

	effect = {
		
		### AVE MARIA ROMAN ADMINISTRATION EFFECTS	
		
		## Assigning Tagma government type when gaining a Tagma title
		if = {
			limit = {
				root = {
					top_liege = {
						any_held_title = {
							OR = {
								this = title:e_byzantium
								this = title:e_roman_empire
							}
						}
					}
				}
				scope:title = { roman_administration_is_a_tagma_title_trigger = yes }
			}
			root = {
				change_government = roman_administration_military_government
				add_realm_law = ave_maria_roman_administration_imperial
			}
		}
		## Assigning Doukaton government type when gaining a Doukaton title
		if = {
			limit = {
				root = {
					top_liege = {
						any_held_title = {
							OR = {
								this = title:e_byzantium
								this = title:e_roman_empire
							}
						}
					}
				}
				#scope:title = { roman_administration_is_a_doukaton_title_trigger = yes }
				#root = { roman_administration_holds_doukaton_title_trigger = yes }
				scope:previous_holder = {
					vassal_contract_has_flag = is_doukaton
				}
			}
			root = {
				change_government = roman_administration_doukaton_government
				add_realm_law = ave_maria_roman_administration_imperial
			}
		}
		## Giving Theme Government type to someone gaining a title under the emperor
		if = {
			limit = {
				root = {
					top_liege = {
						any_held_title = {
							OR = {
								this = title:e_byzantium
								this = title:e_roman_empire
							}
						}
					}
					primary_title = { 
						NOR = { this = title:e_byzantium this = title:e_roman_empire }
						#roman_administration_is_a_military_title_trigger = no
					}
				}
				# scope:title = { 
				# 	roman_administration_is_a_military_title_trigger = no
				# 	#tier <= tier_duchy
				# }
				scope:previous_holder = {
					vassal_contract_has_flag = is_theme
				}
			}
			root = {
				change_government = roman_administration_theme_government
				add_realm_law = ave_maria_roman_administration_imperial
			}
		}
		## Giving Kouratoreia Government to someone gaining a title under the emperor
		if = {
			limit = {
				root = {
					top_liege = {
						any_held_title = {
							OR = {
								this = title:e_byzantium
								this = title:e_roman_empire
							}
						}
					}
					primary_title = { 
						NOR = { this = title:e_byzantium this = title:e_roman_empire }
						roman_administration_is_a_military_title_trigger = no
					}
				}
				scope:title = { 
					roman_administration_is_a_military_title_trigger = no
					#tier <= tier_duchy
				}
				scope:previous_holder = {
					vassal_contract_has_flag = is_kouratoreia
				}
			}
			root = {
				change_government = roman_administration_kouratoreia_government
			}
		}
		## If you inherit the Roman Empire, clear all your previous titles except familial estates
		if = {
			limit = {
				primary_title = {
					this = title:e_byzantium
				}
				scope:title = { this = title:e_byzantium }
			}
			root = {
				roman_administration_emperor_inheritance_effect = yes
				roman_administration_civilian_titles_transfer = yes

				## Counting up number of dynastic emperors
				dynasty = {
					if = {
						limit = {
							NOT = { 
								has_variable = roman_administration_dynastic_number_of_emperors
							}
						}
						set_variable = {
							name = roman_administration_dynastic_number_of_emperors
							value = 0
						}
						change_variable = {
							name = roman_administration_dynastic_number_of_emperors
							add = 1
						}
					}
					if = {
						limit = {
							has_variable = roman_administration_dynastic_number_of_emperors
						}
						change_variable = {
							name = roman_administration_dynastic_number_of_emperors
							add = 1
						}
					}
				}

				## Updating Legitimacy
				every_courtier = {
					roman_administration_update_legitimacy_variable = yes
				}
				every_vassal = {
					roman_administration_update_legitimacy_variable = yes
					every_courtier = {
						roman_administration_update_legitimacy_variable = yes
					}
				}
			}			
			resolve_title_and_vassal_change = scope:change
			# scope:previous_holder = {
			# 	if = {
			# 		limit = {
			# 			is_alive = yes
			# 		}
			# 		scope:previous_holder = {
			# 			roman_administration_remove_terms_of_office_modifier_and_variable = yes
			# 			roman_administration_remove_salary_indicator = yes
			# 		}
					
			# 	}
			# }
		}
		## When inheriting an office duchy title you always get the capital and the de_jure titles
		if = {
			limit = {
				root = {
					top_liege = {
						any_held_title = {
							OR = {
								this = title:e_byzantium
								this = title:e_roman_empire
							}
						}
					}
				}
				scope:title = { 
					tier = tier_duchy
				}
			}
			scope:title = {
				if = {
					limit = {
						scope:title = {
							roman_administration_is_a_tagma_title_trigger = no
							tier >= tier_duchy
						}
					}
					## Capital transfer
					scope:title.title_capital_county = {
						create_title_and_vassal_change = {
							type = granted
							save_scope_as = change
							add_claim_on_loss = yes
						}
						root = {
							save_scope_as = title_heir
						}
						change_title_holder = {
							holder = scope:title_heir
							change = scope:change
						}
					}
					resolve_title_and_vassal_change = scope:change
					
					## The rest
					every_in_de_jure_hierarchy = {
						limit = {
							#tier = tier_county
							tier > tier_barony
							NOT = { 
								this = { has_title_law = ave_maria_roman_administration_family_succession_law }
								has_title_law = ave_maria_roman_administration_family_succession_law							
							}
							NOT = { 
								holder = {
									any_held_title = { this = title:e_byzantium }
								}
							}
							holder = {
								top_liege = {
									any_held_title = { this = title:e_byzantium }
								}
							}
						}
						if = {
							limit = {
								exists = holder
							}
							create_title_and_vassal_change = {
								type = granted
								save_scope_as = change
								add_claim_on_loss = yes
							}
							save_temporary_scope_as = title_to_inherit
							root = {
								save_scope_as = title_heir
							}
							change_title_holder = {
								holder = scope:title_heir
								change = scope:change
							}
							resolve_title_and_vassal_change = scope:change
						}
					}
					resolve_title_and_vassal_change = scope:change
				}

				### Military transfer deprecated since removal of provincial duality krites/strategos
				# if = {
				# 	limit = {
				# 		scope:title = {
				# 			roman_administration_is_a_military_title_trigger = yes
				# 			title_capital_county = {
				# 				holder = {
				# 					top_liege = {
				# 						primary_title = { this = title:e_byzantium }
				# 					}
				# 				}
				# 			}
				# 		}
				# 	}
				# 	## Military Duchy Capital transfer
				# 	scope:title.title_capital_county = {
				# 		create_title_and_vassal_change = {
				# 			type = granted
				# 			save_scope_as = change
				# 			add_claim_on_loss = yes
				# 		}
				# 		root = {
				# 			save_scope_as = title_heir
				# 		}
				# 		change_title_holder = {
				# 			holder = scope:title_heir
				# 			change = scope:change
				# 		}
				# 	}
				# 	resolve_title_and_vassal_change = scope:change
					
				# 	## Military Duchy de jure titles transfer
				# 	every_in_de_jure_hierarchy = {
				# 		limit = {
				# 			#tier = tier_county
				# 			tier > tier_barony
				# 			NOT = { 
				# 				this = { has_title_law = ave_maria_roman_administration_family_succession_law }		
				# 			}
				# 			NOT = { 
				# 				holder = {
				# 					primary_title = { this = title:e_byzantium }
				# 				}
				# 			}
				# 		}
				# 		if = {
				# 			limit = {
				# 				exists = holder
				# 			}
				# 			create_title_and_vassal_change = {
				# 				type = granted
				# 				save_scope_as = change
				# 				add_claim_on_loss = yes
				# 			}
				# 			save_temporary_scope_as = title_to_inherit
				# 			root = {
				# 				save_scope_as = title_heir
				# 			}
				# 			change_title_holder = {
				# 				holder = scope:title_heir
				# 				change = scope:change
				# 			}
				# 			resolve_title_and_vassal_change = scope:change
				# 		}
				# 	}
				# 	resolve_title_and_vassal_change = scope:change
				# }
			}

			resolve_title_and_vassal_change = scope:change
		}

		### AVE MARIA CHRISTIAN FLAVOUR EFFECTS
		## Giving the pope the pope trait
		if = {
			limit = {
				scope:title = {
					this = title:k_papal_state
				}
			}
			root = {
				add_trait = pope
			}
			scope:previous_holder = {
				remove_trait = pope
			}
		}
		## Giving bishops a special trait to prevent them from marrying
		if = {
			limit = {
				scope:title = {
					NOT = { this = title:k_papal_state }
				}
				root = {
					has_government = theocracy_government
					religion = religion:christianity_religion
					highest_held_title_tier = tier_duchy
				}				
			}
			root = {
				add_trait = bishop
			}			
		}
	}

	events = {
		## Roman Administration Terms of Office variable assignement
		ave_maria_roman_administration_events.00012

	
	}
}

# A title is lost by a character
# root = the old holder
# scope:title = the title that changes hands
# scope:new_holder = new holder.
on_title_lost = {


	events = {
		
	}

	# effect = {
	# 	### AVE MARIA ROMAN ADMINISTRATION EFFECTS

	# 	## Variable and modifier cleaning
	# 	if = {
	# 		limit = {
	# 			root = { 
	# 				is_alive = yes
	# 				has_variable = roman_administration_term_count 
	# 				highest_held_title_tier < tier_duchy
	# 			}
				
	# 		}
	# 		root = {
	# 			roman_administration_remove_terms_of_office_modifier_and_variable = yes
	# 			roman_administration_remove_salary_indicator = yes
	# 		}			
	# 	}
	# 	## Making sure you are of civilian government type when losing a previously military title.
	# 	if = {
	# 		limit = {
	# 			scope:title = {
	# 				roman_administration_is_a_military_title_trigger = yes
	# 			}
	# 			root = {
	# 				is_alive = yes
	# 				top_liege = {
	# 					any_held_title = {
	# 						OR = {
	# 							this = title:e_byzantium
	# 							this = title:e_roman_empire
	# 						}
	# 					}
	# 				}					
	# 				any_held_title = { 
	# 					roman_administration_is_a_military_title_trigger = no 
	# 					tier < tier_duchy
	# 					NOT = {
	# 						this = title:e_byzantium
	# 					}
	# 				}
	# 			}
	# 		}
	# 		root = {
	# 			change_government = roman_administration_government
	# 			if = {
	# 				limit = {
	# 					root = {
	# 						uses_roman_govt = yes
	# 						NOT = { has_realm_law = ave_maria_roman_administration_imperial }
	# 					}				
	# 				}
	# 				root = {
	# 					add_realm_law_skip_effects = ave_maria_roman_administration_imperial
	# 				}
	# 			}
	# 		}
	# 	}

	# 	## Clearing up the total salary cost modifier if you lose the roman empire
	# 	if = {
	# 		limit = {
	# 			scope:title = {
	# 				this = title:e_byzantium
	# 			}
	# 			root = {
	# 				is_alive = yes
	# 				has_variable = total_number_of_officials_cost
	# 				any_held_title = {
	# 					NOT = {
	# 						this = title:e_byzantium
	# 					}
	# 				}
	# 			}
	# 		}
	# 		root = {
	# 			roman_administration_clear_salary_cost_variable = yes
	# 			roman_administration_remove_salary_cost_modifier = yes
	# 		}
	# 	}
	# }

}

# A claim is gained by a character
# root = the claimant
# scope:title = the title that is claimed
on_explicit_claim_gain = {
	events = {
		coa.1 # check if title Coat of Arms should change.
	}
}

# A claim is lost by a character
# root = the claimant
# scope:title = the title that was claimed
on_explicit_claim_lost = {
	events = {
		coa.1 # check if title Coat of Arms should change.
	}
}

# A title change makes the character rank up in the landed tiers (eg Duke -> King)
# root = character ranking up
# scope:title = old primary title
on_rank_up = { # Will not fire during history execution or for dying characters
	events = {
	}
	effect = {
		add_achievement_flag = { FLAG = achievement_moving_up_in_the_world_flag }
		update_embassies_effect = yes
		every_ally = {
			update_embassies_effect = yes
		}
	}
}

# A title change makes the character rank down in the landed tiers (eg King -> Duke)
# root = character ranking down
# scope:title = old primary title
on_rank_down = { # Will not fire during history execution or for dying characters
	events = {
	}
	effect = {
		add_character_flag = {
			flag = make_suicide_available
			years = 5
		}
		update_embassies_effect = yes
		every_ally = {
			update_embassies_effect = yes
		}
	}
}

# A character gains a vassal
# root = character gaining vassal
# scope:vassal = vassal being gained
# scope:old_liege = the previous liege of the vassal. Might be the null character (vassal used to be a non-ruler or independent), so make sure to use "exists" checks where relevant
on_vassal_gained = {
	events = {
		realm_maintenance.1000 # Notify vassals of new liege
	}
}
